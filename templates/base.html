{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TaskFlow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=3" />
    <script defer src="{% static 'js/chat_bot.js' %}"></script>
  </head>
  <body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'index' %}">TaskFlow</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'profile' user.id %}"
                >My Profile</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'task_list' user.id %}"
                >My Tasks</a
              >
            </li>
            <li class="nav-item">
              <button
                type="button"
                class="nav-link btn btn-link"
                data-bs-toggle="modal"
                data-bs-target="#logoutModal"
                style="border: none; background: none">
                Logout
              </button>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login_view' %}">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'register' %}">Sign Up</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Messages section -->
    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div
        class="message-{{ message.level_tag }} {{ message.tags }}"
        data-level="{{ message.level }}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <main class="flex-grow-1">
      <!-- Main content goes here -->
      {% block content %}{% endblock %}
    </main>

    <!-- Include Logout Modal for authenticated users -->
    {% if user.is_authenticated %} 
    {% include 'authuser/partials/logout_modal.html' %} 
    {% endif %}

    <!-- Chatbot Modal -->
    <div
      class="modal fade"
      id="chatbotModal"
      tabindex="-1"
      aria-labelledby="chatbotModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="chatbotModalLabel">
              <i class="fas fa-robot me-2"></i>TaskFlow Assistant
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Chat Messages Container -->
            <div id="chatMessages" class="chat-messages mb-3">
              <div class="chat-message bot-message">
                <span class="message-content">
                  <i class="fas fa-robot me-2"></i>
                  Hello! I'm your TaskFlow assistant. How can I help you today? This is currently a beta version of this bot therefore unfortunately
                  I am currently only able to perform the following: create tasks for you, updating one of your tasks for you 
                  (I will need the title of the task), deleting tasks, reading tasks Information for you and creating tasks for all your direct or indirect
                  subordinates. Please put all Information in "quotation marks" as it helps me to understand. You may also need to refresh to see changes 
                  I've made.
                </span>
                <span class="time-stamp">Just now</span>
              </div>
            </div>

            <!-- Chat Input -->
            <div class="input-group">
              <input
                type="text"
                id="chatInput"
                class="form-control"
                placeholder="Type your message..."
                aria-label="Chat message" />
              <button
                class="btn btn-primary"
                type="button"
                id="sendButton"
                aria-label="Button to send message to chatbot"
                data-user="{{user.id}}">
                <i class="fas fa-paper-plane"></i>
                <small hidden>Shh I'm not really here!</small>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% if user.is_authenticated %}
    <!-- Floating Chat Button -->
    <button
      id="chatbotToggle"
      class="btn btn-primary"
      aria-label="Button to open up the chatbot modal"
      data-bs-toggle="modal"
      data-bs-target="#chatbotModal">
      <i class="fas fa-comments"></i>
    </button>
    {% endif %}
    <footer class="footer mx-auto col-12">
      &copy; 2025 TaskFlow. All rights reserved. Created by David Barton
      <a href="https://github.com/GenericName192" target="_blank">Github</a>
      <a href="https://www.linkedin.com/in/davidbarton192/" target="_blank"
        >Linkedin</a
      >
    </footer>
  </body>
</html>
